<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libcp2p: Secure Connections Overview</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libcp2p
   </div>
   <div id="projectbrief">A libp2p-like protocol with first class support for embedded systems. End goal is a protocol that can run on anything from your fridge, embedded systems, and anything else. Higher level languages bindings will be done via FFI. Heavy WIP</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d3/d9b/md__media_solidity__d_a_t_a__code__r_trade_ltd_libcp2p_docs__s_e_c_u_r_e__c_o_n_n_e_c_t_i_o_n_s.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Secure Connections Overview </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>When connecting to a remote peer, we have a multiaddress that looks like <code>/ip4/127.0.0.1/tcp/9090/p2p/somepeerid</code>. <code>somepeerid</code> corresponds to the SHA256 hash of an ECC public key in PEM format. When connecting to the remote peer, we initiate the connection over an insecure connection asking for public key corresponding to the peerID. When we receive the public key, we calculate the peerID locally. If it matches we then initiate an ECDH key agreement. The new key from the key agreement is used to then encrypt/decrypt messages with the peer.</p>
<h1><a class="anchor" id="autotoc_md43"></a>
Why Not Just Use TLS</h1>
<p>The main reason for not using TLS directly is that it is a resource intensive process and requires using trusted CA issued certificates. By just using ECDSA keys and ECDH for shared secret negotiation, we can have a lightweight method of providing secure communications. Eventually a TLS implementation may be integrated if it proves to be needed.</p>
<h1><a class="anchor" id="autotoc_md44"></a>
Process</h1>
<h2><a class="anchor" id="autotoc_md45"></a>
Code</h2>
<p>put this into mermaidjs to generate the diagram</p>
<div class="fragment"><div class="line">sequenceDiagram</div>
<div class="line">    Peer1-&gt;&gt;+Peer2: Connect to multiaddress of peer2</div>
<div class="line">    Peer1-&gt;&gt;+Peer2: Ask for public key corresponding to the multiaddress</div>
<div class="line">    Peer2-&gt;&gt;+Peer1: Reply with ECC public key</div>
<div class="line">    Peer1-&gt;&gt;+Peer1: Compute sha256 hash of ECC public key and convert to PeerID format</div>
<div class="line">    Peer1-&gt;&gt;+Peer1: Verify that the peerID is the same, otherwise disconnected</div>
<div class="line">    Peer1-&gt;&gt;+Peer2: Conduct ECDH key agreement to derive shared secret key</div>
<div class="line">    Peer2-&gt;&gt;+Peer1: </div>
<div class="line">    Note over Peer1,Peer2: After successful key agreement all messages exchange via encryption</div>
<div class="line">    Note over Peer1,Peer2: Secret key for AES message encryption is sha256 hash of ECDH priv key</div>
<div class="line">    Note over Peer1,Peer2: We take the sha256 hash of the private key in PEM format</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md46"></a>
Diagram</h2>
<p><img src="https://gateway.temporal.cloud/ipfs/QmR39BfPRcyXawA7X7eXrhmsCAEMYM1ZfPzZjYmg7buntW" alt="" class="inline"/> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
